var CheckoutPopup;!function($){"use strict";CheckoutPopup=function(a){this.triggerClass=a,this.jTrigger=$(a),this.jQty=$(".js-add-to-cart-gty"),this.lockClass="lock",this._eventPrefix=".CheckoutPopup",this.popupWrap=$(".js-warp-popup-hidden"),this.popupId="#cart-popup",this.removePopupItem=".js-cart-popup-item",this.promoCodeForm=".js-promo-code-form",this.closePoppup=".js-cart-popup-close",this.init()},CheckoutPopup.prototype={init:function(){this.initEvents()},initEvents:function(){var a=this;this.getParentForm(this.jTrigger).length&&this.lockSubmit(),$("body").on("click"+this._eventPrefix,this.triggerClass,function(b){var c=$(this),d=a.getParentForm(c).serializeArray()||[],e=c.data("checkout-popup-url"),f=+a.jQty.data("gty");b.preventDefault(),c.find(a.jQty).length&&!f||(d.push({name:"isAjax",value:1}),$.ajax({global:!1,type:"POST",dataType:"json",data:d,url:e,beforeSend:function(){a.showOverlay()},success:function(b){a.hideOverlay(),a.popupWrap.find(a.popupId).html("").append(b.content),a.toggleLoader("hide"),$.magnificPopup.open({items:{src:a.popupId},type:"inline"}),a.initPlugins(),a.updateQty(b.qty)},error:function(a){}}))}).on("click"+this._eventPrefix,this.removePopupItem,function(b){var c=$(this),d=a.getParentForm(c).serialize()||"",e=c.data("url");c.closest(a.popupId).length&&b.preventDefault(),a.update(e,d)}).on("click"+this._eventPrefix,this.closePoppup,function(a){event.preventDefault(),$.magnificPopup.close()}).on("submit"+this._eventPrefix,this.promoCodeForm,function(b){var c=$(this),d=c.serialize()||"",e=c.attr("action");b.preventDefault(),a.update(e,d)})},initPlugins:function(){var a=this,b=$(".js-quantity");b.data("quantityUi")&&b.quantityUi("destroy"),b.quantityUi({plusClass:"quantity__plus",minusClass:"quantity__minus",afterTriggerButton:function(b,c,d){var e=c.siblings(d.input),f=e.data("url"),g=[];g.push({name:"qty",value:e.val()}),a.update(f,g)},afterChange:function(b,c,d){var c=c,e=c.data("url"),f=[];f.push({name:"qty",value:c.val()}),a.update(e,f)}})},update:function(a,b){var c=this;$.ajax({global:!1,type:"POST",dataType:"json",data:b,url:a,beforeSend:function(){c.toggleLoader("show")},success:function(a){if($(c.popupId).find(".js-cart-popup-outer").replaceWith(a.content),c.initPlugins(),c.updateQty(a.qty),c.toggleLoader("hide"),"undefined"!=typeof onepageUI){var b=onepageUI.getCurrentStep();0===a.qty&&window.location.reload(),onepageUI.getProgress(b.data("url-progress"))}},error:function(a){}})},updateQty:function(a){this.jQty.data("gty",a),a?this.jQty.text("("+a+")").parent().prev().addClass("decor"):this.jQty.text(this.jQty.data("empty")).parent().prev().removeClass("decor")},getParentForm:function(a){return a.closest("form")},lockSubmit:function(){var a=this.getParentForm(this.jTrigger);a.on("submit"+this._eventPrefix,function(a){a.preventDefault()})},toggleLoader:function(a){var b=$(this.popupId);switch(a){case"show":b.addClass("loader");break;case"hide":b.removeClass("loader")}},showOverlay:function(){var a=$("<div/>",{class:"overlay js-overlay"});a.appendTo("body")},hideOverlay:function(){$(".js-overlay").remove()}}}(jQuery);